<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Contract Agent Subscription (Demo)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            max-width: 720px;
        }

        button {
            padding: 12px 16px;
            margin: 8px 0;
            width: 260px;
            font-size: 16px;
            cursor: pointer;
        }

        .note {
            color: #444;
            margin-top: 18px;
            line-height: 1.5;
        }

        a {
            color: #0067b8;
        }

        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <h1>Activate your subscription (Demo)</h1>
    <p>Select a plan to activate it for your organisation (no payment in demo).</p>

    <button onclick="activate('Bronze')">Activate Bronze</button><br />
    <button onclick="activate('Silver')">Activate Silver</button><br />
    <button onclick="activate('Gold')">Activate Gold</button><br />

    <p class="note">
        Clicking a plan sends you to a secure activation endpoint (your Function App).
        Because the Function App uses Entra SSO, you may be prompted to sign in.
        The backend writes your plan to Azure Table Storage for your tenant, then redirects you back here.
    </p>

    <p class="note">
        <a id="resetLink" href="#">Reset subscription (demo)</a>
    </p>

    <script>
        const APP_ORIGIN = "https://contract-weakness-api-ezdzg5hzcjfpfpa2.uksouth-01.azurewebsites.net";

        function loginThenGo(pathAfterLogin) {
            // Uses App Service Easy Auth sign-in endpoint.
            // After login, user gets redirected to the path you specify.
            const loginUrl = `${APP_ORIGIN}/.auth/login/aad?post_login_redirect_uri=${encodeURIComponent(pathAfterLogin)}`;
            window.location.href = loginUrl;
        }

        function activate(plan) {
            loginThenGo(`/api/subscription/activate?plan=${encodeURIComponent(plan)}`);
        }

        // Update reset link to go through login too
        document.getElementById("resetLink").href =
            `${APP_ORIGIN}/.auth/login/aad?post_login_redirect_uri=${encodeURIComponent("/api/subscription/reset")}`;
    </script>

</body>

</html>